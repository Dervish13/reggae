.Dd $Mdocdate: May 20 2018 $
.Dt REGGAE_PROVISION 1
.Os
.Sh NAME
.Nm reggae-provision
.Nd Setup and configure jail in automated way
.Sh SYNOPSIS
.Nm supported provisioners
.Sh DESCRIPTION
.Pp
Supported
.Em provisioners
are:
.Bl -bullet -offset indent -compact
.It
Ansible
.It
Chef
.It
Puppet
.It
Salt Stack
.It
Shell
.El
Reggae will generate playbook directory where all files for your provisioner will be.
.Sh ANSIBLE
.Pp
A service with ansible provisioner consists of:
.Bl -bullet
.It
\fBMakefile\fR - configured for use with Ansible
.It
\fBplaybook\fR - containing group_vars, inventory and roles directories as placeholders for files generated on the fly, but can be used to configure your playbook
.It
\fBrequirements.yml\fR - list of requirements, with only one initially. All requirements from this file are downloaded from Ansible Galaxy
templates/site.yml.tpl - this file should be edited to add/remove roles, playbooks, etc.
.El
.Pp
When ran with this configuration, reggae will first check if ansible executable
is available on  the host, and if it isn't, it will run \fBpkg install ansible\fR.
If you use Python's virtual environments, for example, you can avoid having
ansible available to everyone on the system.
.Sh CHEF
.Pp
A service with chef provisioner consists of:
.Bl -bullet
.It
\fBMakefile\fR - configured for use with chef
.It
\fBplaybook\fR - containing cookbooks/core/recipes/default.rb dummy script
.El
.Pp
When ran with this configuration, reggae will first check if chef executable
is available, and if it isn't, it will run \fBpkg install -y chef\fR inside
jail. Then it will mount playbook directory on /root/chef inside jail. To do
actual provisioning, Reggae uses \fBchef-client --local-mode\fR.
.Sh PUPPET
.Pp
A service with puppet provisioner consists of:
.Bl -bullet
.It
\fBMakefile\fR - configured for use with puppet
.It
\fBplaybook\fR - containing cookbooks/core/recipes/default.rb dummy script
.El
.Pp
When ran with this configuration, reggae will first check if puppet executable
is available inside jail, and if it isn't, it will install it from packages.
Then it will mount playbook directory on /usr/local/etc/puppet/manifests inside
jail. To do actual provisioning, Reggae uses \fBpuppet apply\fR.
.Sh SALT STACK
.Pp
A service with salt provisioner consists of:
.Bl -bullet
.It
\fBMakefile\fR - configured for use with salt
.It
\fBplaybook\fR - containing top.sls and core.sls playbooks
.El
.Pp
When ran with this configuration, reggae will first check if salt executable is
available, and if it isn't, it will run \fBpkg install -y py36-salt\fR inside
jail. Then it will mount playbook directory on /usr/local/etc/salt/states inside
jail. To do actual provisioning, Reggae uses \fBsalt-call --local state.apply\fR.
.Sh SHELL
.Pp
A service with shell provisioner consists of:
.Bl -bullet
.It
\fBMakefile\fR - configured for use with shell
.It
\fBplaybook\fR - containing dummy provision.sh to start with
.El
.Pp
When ran with this configuration, reggae will first mount playbook directory on
/root/shell inside jail. To do actual provisioning, Reggae will run
\fB/root/shell/provision.sh\fR.
.Sh EXAMPLES
.Pp
Quickest way to get basic service provisioned with Ansible is:
.Pp
.Dl mkdir myservice
.Dl cd myservice
.Dl reggae init shell
.Dl make
.Pp
You can have multiple provisioners, and the order they are declared on the
command line is the order they will be executed in.
.Pp
.Dl mkdir myservice
.Dl cd myservice
.Dl reggae init shell ansible
.Dl make
.Sh SEE ALSO
.Xr reggae 1
.Sh AUTHORS
Goran MekiÄ‡ <meka@tilda.center>
